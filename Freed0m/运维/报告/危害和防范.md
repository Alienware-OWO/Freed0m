`记录部分平常渗透测试遇到的案例，整理如下，出报告专用`

---

## 大纲
```markdown
1. 认证、登录类
    - 弱口令
    - 存在风险
2. web 漏洞
    - 常见
    - 信息泄露类
    - 逻辑类
    - Fuzz
    - 中间件/服务
3. OS 类
    - windows
4. 业务/软件/协议 vul
    - 数据库
    - 远程服务
    - 文件服务
    - 分布式
5. 其他杠精漏洞
```

---

# 认证、登录类
## 弱口令
**web 后台系统弱口令**
- 详情
    > 渗透测试过程中，发现目标 web 后台管理存在弱口令组合。

- 造成的危害：
    > 攻击者利用弱口令登录网站管理后台，可对数据进行恶意的增删改等操作，从而造成一定破坏。

- 安全控制建议
    ```
    1. 管理员账号不要采用弱口令，建议密码强度 8 位以上，大小写数字混合。
    2. 对短时间内多次登录失败的 IP 做限制,例如某 IP 一小时内连续登录失败 3 次，6 个小时内禁止该 ip 访问。
    ```

**ftp 弱口令**
- 详情
    > 渗透测试过程中，发现远程 FTP Server 允许以弱口令组合登录。

- 造成的危害：
    > 这可能允许攻击者上传恶意文件或者下载敏感文件。

- 安全控制建议
    > FTP 服务如果不是必须使用，可以关闭，或更新到最新版本，并不要采用弱口令

**ftp 匿名登陆**
- 详情
    > 渗透测试过程中，发现目标主机开放的 ftp 服务允许匿名用户进行登录。

- 造成的危害：
    > 黑客利用弱口令或匿名登录漏洞直接登录 FTP 服务，上传恶意文件，从而获取系统权限，并可能造成数据泄露。

- 安全控制建议
    > FTP 服务如果不是必须使用，可以关闭，或更新到最新版本，并关闭匿名访问。

**xxx 弱口令/空口令**
- 详情
    > 渗透测试过程中，发现目标服务器存在 xxx 服务弱口令问题。

- 造成的危害：
    > 攻击者经过爆破登陆后可完全控制机器，即使低权限账号也可以通过提权进行进一步的破坏。

    或

    > 攻击者经过爆破登陆后可完全控制目标数据库，进而可以对数据信息进行窃取、篡改等操作。

- 安全控制建议
    > 账号不要采用弱口令，建议密码强度 8 位以上，大小写数字混合。

**xxx 后台无安全认证**
- 详情
    > 渗透测试过程中，发现目标xxx服务无任何安全认证。

- 造成的危害：
    > 攻击者进入管理后台可以获取目标业务信息，甚至对其系统进行一定修改破坏。

- 安全控制建议
    ```
    1. xxx 服务后台加上安全认证。
    2. 账号不要采用弱口令，建议密码强度 8 位以上，大小写数字混合。
    ```

## 存在风险
**爆破风险**
- 详情
    > 在后台登录页面，登录时错误提示信息明确，因此可以判断用户名是否存在，然后针对用户名进行暴力破解。

    或

    > 在后台登录页面，登录时错误提示信息明确，且未对登录失败做访问控制，导致攻击者可以进行持续暴力破解登录口令。

- 造成的危害：
    > 攻击者可以针对某已知用户名进行慢速暴力破解，从而进入后台。

- 安全控制建议
    ```
    1. 修改错误提示信息，加强逻辑认证
    2. 加上 IP 限制，例如 1.1.1.1 一小时内连续登录失败 3 次，禁止该 ip 访问。
    ```

**验证码可绕过**
- 详情
    > 在后台登录页面，验证码只在前台 js 校验，攻击者在爆破账号可以进行绕过。

    或

    > 在后台登录页面，验证码只验证一次，攻击者只需截取第一个包即可进行绕过实施账号爆破。

- 造成的危害：
    > 由于可以绕过验证码，导致攻击者对后台的爆破难度大大降低。

- 安全控制建议
    ```
    1. 将验证码判断放在后端进行。
    2. 加上 IP 限制，例如 1.1.1.1 一小时内连续登录失败 3 次，禁止该 ip 访问。
    ```

---

# web 漏洞
## 常见
**文件上传类**
- 详情
    > 测试过程中发现目标站点多处存在文件上传漏洞,上传文件的时，如果未对上传的文件进行严格的验证和过滤，就容易造成文件上传漏洞，上传脚本等。

- 造成的危害：
    > 攻击者通过上传恶意文件可能导致网站被控制，甚至可以进一步的进行提权，控制目标机器，进入目标内网。

- 安全控制建议
    ```
    1. 限制文件上传类型
    2. 限制上传文件大小
    3. 确保上传文件被访问正确返回
    4. 确保上传的文件放在安全的路径下，必要时可以将上传的文件存在 web server 之外的远程服务器。
    ```

**任意文件删除**
- 详情
    > 渗透测试过程中，发现目标存在一处操作接口，可导致任意文件删除操作

- 造成的危害：
    > 攻击者可利用该接口删除网站任意文件，从而对目标系统造成巨大破坏。

- 安全控制建议
    > 具体修复方法请联系软件公司解决。

**目录浏览(目录遍历)**
- 详情
    > 目录遍历（路径遍历）是由于 web 服务器或者 web 应用程序对用户输入的文件名称的安全性验证不足而导致的一种安全漏洞。

- 造成的危害：
    > 攻击者通过利用一些特殊字符就可以绕过服务器的安全限制，访问任意的文件（可以使 web 根目录以外的文件），甚至执行系统命令。

- 安全控制建议
    ```
    1. 避免由外界指定文件名
    2. 文件名中不可以包含目录
    3. 限定文件名中仅包含字母与数字
    4. 指定可以访问的白名单。
    ```

## 信息泄露类
**测试系统环境开放**
- 详情
    > 渗透测试过程中，发现目标测试系统访问对公网开放，毫无安全防护措施

- 造成的危害：
    > 即使是测试系统也可能会存在一定的敏感数据，而且攻击者也可能通过拿下测试系统的机器来更近一步的横向渗透，对整个业务系统造成极大影响

- 安全控制建议
    > 停止对外开放测试系统,并检查有无同类系统存在该问题。

**某查询接口造成用户信息泄露**
- 详情
    > 在 xxxx 页面时，经过更改的查询请求可以绕过查询限制，从而查询到任意用户的缴费数据。

- 造成的危害：
    > 恶意分子通过批量查询用户信息，导致用户 xxxx 信息泄漏，可以对用户实施钓鱼、诈骗等。甚至用于黑产。

- 安全控制建议
    > 对查询请求做好检查和限制。

**端口泄漏历史命令记录**
- 详情
    > 在浏览器访问 xxxxxx 页面时，会暴露出主机历史命令记录。

- 造成的危害：
    > 攻击者可以针对已知命令作出相应的攻击，例如在管理员添加新用户和更改密码后查询记录就泄漏了用户帐号密码。

- 安全控制建议
    > 关闭不用的端口。

**配置文件泄露**
- 详情
    > 目标网站存在配置文件泄露问题，包含部分项目文件路径信息、配置参数信息等。

- 造成的危害：
    > 泄露的配置文件可能会包含路径信息，甚至可能包含部分数据库配置参数。

- 安全控制建议
    > 对目标路径设置不可访问。

## 逻辑类
**越权修改**
- 详情
    > 越权漏洞是 Web 应用程序中一种常见的安全漏洞。该漏洞是指应用在检查授权时存在纰漏，使得攻击者在获得低权限用户账户后，利用一些方式绕过权限检查(比如说修改数据包的值或者直接访问其他用户相应页面的链接），访问或者操作其他用户或者更高权限用户才能访问到的页面或数据。

- 造成的危害：
    > 越权修改信息就是同等角色下的用户，不但能够修改自己私有的数据，还能修改其他人私有的数据，包括管理员。

- 安全控制建议
    > 鉴权，服务端对请求的数据和当前用户身份做校验；基础安全架构，完善用户权限体系。

**越权访问**
- 详情
    > 越权漏洞是 Web 应用程序中一种常见的安全漏洞。该漏洞是指应用在检查授权时存在纰漏，使得攻击者在获得低权限用户账户后，利用一些方式绕过权限检查(比如说修改数据包的值或者直接访问其他用户相应页面的链接），访问或者操作其他用户或者更高权限用户才能访问到的页面或数据。

- 造成的危害：
    > 该漏洞将导致攻击者请求操作（增删改查）某条数据时，web 应用程序没有判断该条数据的所属人，或者在判断数据所属人时直接从用户提交的表单参数中获取，例如用户 id 等，导致攻击者可以自行修改参数，操作获取不属于自己的数据。

- 安全控制建议
    > 鉴权，服务端对请求的数据和当前用户身份做校验；基础安全架构，完善用户权限体系。

**支付数据可被篡改**
- 详情
    > 填写完缴款页面，在进入网银缴费页面前，确认缴费信息时，可通过 burpsuite 软件篡改本地缴费金额，欺骗本地缴费系统，以达到以少付多的效果。

- 造成的危害：
    > 例如某机关单位张三缴款时利用该漏洞缴款 100000 元，本地篡改数据为 0.1 元，即可完成只花费 0.1 元实现 100000 元的缴款。

- 安全控制建议
    > 取消支付页面的 http 访问，调整支付逻辑。并且后端复查实际金额。

**短信验证码接口可被利用**
- 详情
    > 在用户注册页面， 其发所短信验证码接口未做限制，导致重复发包时可以绕过前台时间限制。

- 造成的危害：
    > 攻击者可以重复 post 请求，针对某手机号进行短信轰炸。

- 安全控制建议
    ```
    1. 将短信验证码时间限制判断放在后端进行。
    2. 加上 IP 限制，例如某 IP 一小时内连续登录发送 3 次，6 个小时内禁止该 ip 发送。
    ```

## Fuzz
**XSS**
- 详情
    > XSS 又称 CSS，全称 Cross SiteScript，跨站脚本攻击，是 Web 程序中常见的漏洞，XSS 属于被动式且用于客户端的攻击方式，所以容易被忽略其危害性。其原理是攻击者向有 XSS 漏洞的网站中输入(传入)恶意的 HTML 代码，当其它用户浏览该网站时，这段 HTML 代码会自动执行，从而达到攻击的目的。如，盗取用户 Cookie、破坏页面结构、重定向到其它网站等。

- 造成的危害：
    > 攻击者可在网址中插入特定的 XSS 代码，将访客的 cookie 等信息发送到远程 C&C 服务器，从而窥探用户隐私甚至财产。

- 安全控制建议
    ```
    1.	不信任用户提交的任何内容，对所有用户提交内容进行可靠的输入验证，包括对 URL、查询关键字、HTTP 头、REFER、POST 数据等，仅接受指定长度范围内、采用适当格式、采用所预期的字符的内容提交，对其他的一律过滤。尽量采用 POST 而非 GET 提交表单；对“<”，“>”，“；”，“””等字符做过滤；任何内容输出到页面之前都必须加以 en-code，避免不小心把 htmltag 显示出来。
    2.	实现 Session 标记（session tokens）、CAPTCHA（验证码）系统或者 HTTP 引用头检查，以防功能被第三方网站所执行，对于用户提交信息的中的 img 等 link，检查是否有重定向回本站、不是真的图片等可疑操作。
    3.	cookie 防盗。避免直接在 cookie 中泄露用户隐私，例如 email、密码，等等；通过使 cookie 和系统 IP 绑定来降低 cookie 泄露后的危险。这样攻击者得到的 cookie 没有实际价值，很难拿来直接进行重放攻击。
    4.	确认接收的内容被妥善地规范化，仅包含最小的、安全的 Tag（没有 JavaScript），去掉任何对远程内容的引用（尤其是样式表和 JavaScript），使用 HTTPonly 的 cookie。
    ```

**SQL 注入**
- 详情
    > 页面存在 SQL 注入漏洞,SQL 注入漏洞允许攻击者通过操纵用户输入来更改后端 SQL 语句。当 web 应用程序接受直接放入 SQL 语句的用户输入，并且没有正确过滤掉危险字符时，就会发生 SQL 注入。

- 造成的危害：
    > 攻击者可以在易受攻击的系统上执行任意 SQL 语句。根据正在使用的后端数据库， SQL 注入漏洞会导致攻击者访问不同级别的数据/系统。不仅可以操作现有查询，还可以合并任意数据、使用子选择或追加附加查询。在某些情况下，可以读入或写出文件，或者在底层操作系统上执行 shell 命令。 某些 SQL 服务器包含存储和扩展过程(数据库服务器功能)。如果攻击者能够获得这些程序的访问权限，可能会危及整个机器。

- 安全控制建议
    ```
    1. 程序代码里的所有查询语句，使用标准化的数据库查询语句 API 接口，设定语句的参数进行过滤一些非法的字符，防止用户输入恶意的字符传入到数据库中执行 sql 语句。
    2. 对用户提交的的参数安全过滤，像一些特殊的字符（，（）*&……%# 等等）进行字符转义操作,以及编码的安全转换。
    3. 网站的报错信息尽量不要返回给客户端，比如一些字符错误，数据库的报错信息，尽可能的防止泄露给客户端。
    ```

## 中间件/服务
**iis短文件名泄露漏洞**
- 详情
    > 目标存在 IIS 短文件名泄露漏洞。Internet Information Services 是由微软公司提供的基于运行 Microsoft Windows 的互联网基本服务。Microsoft IIS 在实现上存在文件枚举漏洞，攻击者可利用此漏洞枚举网络服务器根目录中的文件。

- 造成的危害：
    > 攻击者可以利用该漏洞猜解后台地址和敏感文件甚至直接下载对应文件，或对 IIS 服务器中的 .Net Framework 进行拒绝服务攻击。

- 安全控制建议
    > 升级 .net framework 至 4.0 版本或以上。

**存在 Struts2 远程代码执行漏洞**
- 详情
    > 渗透测试过程中，发现目标站点存在 Struts2 远程代码执行漏洞，该漏洞可以远程代码执行。

- 造成的危害：
    > 由于该漏洞影响范围较广，漏洞危害程度严重，可造成直接获取应用系统所在服务器的控制权限。

- 安全控制建议
    > 及时更新网站 strust2 框架或更新相应补丁。

---

# OS类
## windows
**MS12-020**
- 详情
    > MS12-020 漏洞是微软在 12 年发布的一个 windows 系统漏洞，该漏洞针对于windows xp 和 windows sever 2003 等系统。攻击者通过该漏洞对目标主机进行攻击，可导致目标主机蓝屏。

- 造成的危害：
    > 远程攻击者在未经认证的情况下往服务器发送畸形恶意的数据包，便可以以系统权限或者 NET SERVICE 权限执行任意命令。

- 安全控制建议
    > 针对 MS12-020 漏洞，微软官方已放出相应的补丁，建议及时安装官方补丁。

**MS15-034**
- 详情
    > 在2015年4月安全补丁日，微软发布了11项安全更新，共修复了包括 Microsoft Windows、Internet Explorer、Office、.NET Framework、Server 软件、Office Services 和 Web Apps 中存在的26个安全漏洞。其中就修复了 HTTP.sys 中一处允许远程执行代码漏洞，编号为：CVE-2015-1635（MS15-034 ）。

- 造成的危害：
    > 据称，利用 HTTP.sys 的安全漏洞，攻击者只需要发送恶意的 http 请求数据包，就可能远程读取 IIS 服务器的内存数据，或使服务器系统蓝屏崩溃。

- 安全控制建议
    > 针对 MS15-034 漏洞，微软官方已放出相应的补丁，建议及时安装官方补丁。

**MS17-010**
- 详情
    > 目标主机开放了 445 端口，其中存在 MS17-010 漏洞。

- 造成的危害：
    > 该漏洞是 Windows 的 SMB 服务处理 SMB v1 请求时发生的漏洞，这个漏洞导致攻击者可以使用该漏洞使目标机器反代连接到 cc 服务器，进行远程控制主机、在局域网传播木马等破坏行为。

- 安全控制建议
    > 针对 MS17-010 漏洞，微软官方已放出相应的补丁，建议及时安装官方补丁。

**CVE-2019-0708 漏洞**
- 详情
    > 北京时间5月15日，Windows 再次被曝出一个破坏力巨大的高危远程漏洞 CVE-2019-0708。攻击者一旦成功利用该漏洞，便可以在目标系统上执行任意代码，包括获取敏感信息、执行远程代码、发起拒绝服务攻击等等攻击行为。

- 造成的危害：
    > 这个漏洞的触发无需用户交互，攻击者可以用该漏洞制作堪比 2017 年席卷全球的 WannaCry 类蠕虫病毒，从而进行大规模传播和破坏。

- 安全控制建议
    > 针对 CVE-2019-0708 漏洞，微软官方已放出相应的补丁，建议及时安装官方补丁。

---

# 业务/软件/协议 vul
## 数据库
**Oracle 远程数据投毒漏洞（CVE-2012-1675）**
- 详情
    > 服务器存在 oracle 远程数据投毒漏洞，该漏洞可以远程获取到 oracle 的内存信息，若是能获取到内存中的数据即为存在漏洞，进而可以再爆破 oracle 的 SID。

- 造成的危害：
    > 攻击者可以在不需要用户名密码的情况下利用网络中传送的数据消息(包括加密或者非加密的数据)，如果结合（CVE-2012-3137 漏洞进行密码破解）从而进一步影响甚至控制局域网内的任何一台数据库。

- 安全控制建议
    > Oracle 数据库及时更新补丁。

**Mongodb 未授权访问漏洞**
- 详情
    > 目标服务器在开启 MongoDB 服务时不添加任何参数,默认是没有权限验证的

- 造成的危害：
    > 登录的用户可以通过默认端口无需密码对数据库任意操作(增删改高危动作)而且可以远程访问数据库

- 安全控制建议
    > 修改默认端口，不要开放到公网 0.0.0.0，禁用 HTTP 和 REST 端口，开启日志审计功能，开启 MongoDB 授权

## 远程服务
**SNMP默认团体字符串可被枚举**
- 详情
    > 渗透测试过程中，发现目标SNMP服务配置了默认的团体字符串，snmp 是用来进行网络管理的。cacti 和 mrtg 等监控工具都是基于 snmp 协议。

- 造成的危害：
    > snmp 弱口令或者口令泄漏引起的安全问题：一是信息泄漏，二是设备的配置可能被修改从而被他人控制。

- 安全控制建议
    > 修改 SNMP 的默认团体字符串，使用强度更高的字符串。

**CVE-2018-15473 OpenSSH 用户枚举漏洞**
- 详情
    > 通过向 OpenSSH 服务器发送一个错误格式的公钥认证请求，可以判断是否存在特定的用户名。如果用户名不存在，那么服务器会发给客户端一个验证失败的消息。如果用户名存在，那么将因为解析失败，不返回任何信息，直接中断通讯。

- 造成的危害：
    > 由于 SSH 本身的认证机制存在缺陷，导致攻击者可以使用字典，暴力枚举 SSH 存在的用户名(Username)

- 安全控制建议
    > 升级 openssh

## 文件服务
**CVE-1999-0554 目标主机 showmount -e 信息泄露**
- 详情
    > 目标服务器由于错误的 nfs 配置，导致文件内容信息泄露。

- 造成的危害：
    > NFS 服务配置漏洞可能会赋予根目录远程可写权限,导致攻击者远程写入密钥进行远程登录。

- 安全控制建议
    > 修改 NFS 配置文件，对于不受信任的 IP，禁止访问。

## 分布式
**Hadoop 未授权访问漏洞**
- 详情
    > 该问题产生是由于管理员在配置失误所致，导致直接开放了 Hadoop 机器 HDFS 的 50070 web 端口及部分默认服务端口。

- 造成的危害：
    > 黑客可以通过命令行操作多个目录下的数据，如进行删除操作，安全风险高。

- 安全控制建议
    > 如无必要，关闭 Hadoop Web 管理页面；开启服务级别身份验证，如 Kerberos 认证；部署 Knox、Nginx 之类的反向代理系统，防止未经授权用户访问；

**ZooKeeper 未授权访问漏洞**
- 详情
    > 知道服务端的 IP 和 Port，任务用户或者客户端根本不需要任何的认证就可以连上 ZooKeeper 的服务端，并且可以对 znode 进行增删等操作。这样数据是非常不安全的，极易被攻击和篡改。

- 造成的危害：
    > 攻击者渗透中遇到 ZooKeeper 集群后，可以查找事务日志来获取 admin 的密码或者其他敏感资源的认证方法。

- 安全控制建议
    > 配置 zookeeper 通过 ACL 机制控制 znode 节点的访问权限。

---

# 其他杠精漏洞
**主机使用统一密码**
- 详情
    > 在内网环境进行测试时，根据抓取的密码进行横向渗透，发现多台主机密码相同。

- 造成的危害：
    > 当恶意分子通过漏洞渗透进入某一台主机，获得密码后，整个内网主机都将会被侵入。

- 安全控制建议
    > 加强密码管理，不同主机密码不应相同。

**开放端口过多**
- 详情
    > 开启了多余服务端口 xxx\xxx\xxx

- 造成的危害：
    > 攻击者可以针对目标端口访问结果收集到相关信息，做出下一步的入侵。

- 安全控制建议
    > 对开放端口做好控制限制，关闭不常用的端口。

**后台地址不够隐秘**
- 详情
    > 目标管理后台地址不够隐秘，容易被攻击者猜测、发现。

- 安全控制建议
    > 管理页面的地址尽量隐藏，可以多加路径，不能轻易被攻击者发现。

---

`真实的、永恒的、最高级的快乐，只能从三样东西中取得：工作、自我克制和爱。(罗曼·罗兰《托尔斯泰传》)`
